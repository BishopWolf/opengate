#!/usr/bin/env python3
# -*- coding: utf-8 -*-

import opengate as gate
import click
import radioactivedecay as rd
import matplotlib.pyplot as plt

CONTEXT_SETTINGS = dict(help_option_names=["-h", "--help"])


@click.command(context_settings=CONTEXT_SETTINGS)
@click.argument("rad_name", nargs=1)
@click.option("--output", "-o", default=None, help="output file")
@click.option("--timing", "-t", multiple=True, default=[2, 24, 5 * 24], help="timing")
def go(rad_name, output, timing):
    # get nuclide, a, z
    nuclide = gate.get_nuclide(rad_name)

    # plot for 2 hours, 1 day and 5 days
    inv = rd.Inventory({nuclide.nuclide: 1.0}, "MBq")
    fig, ax = plt.subplots(ncols=len(timing), nrows=1, figsize=(5 * len(timing) + 5, 5))

    if len(timing) == 1:
        ax = [ax]
    i = 0
    for t in timing:
        inv.plot(t, "h", yunits="Bq", fig=fig, axes=ax[i])
        i += 1
    plt.suptitle(f"{nuclide.nuclide}   half life = {nuclide.half_life('readable')}")

    if output:
        print(f"Output plot in {output}")
        fig.savefig(output)
    else:
        plt.show()


# --------------------------------------------------------------------------
if __name__ == "__main__":
    go()
